{% load sass_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}–ö—Ä–µ–¥–∏—Ç–û–±–∑–æ—Ä - —Å–∞–π—Ç –æ—Ç–∑—ã–≤–æ–≤ –æ –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö, –æ–Ω–ª–∞–π–Ω –∑–∞–π–º–∞—Ö –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö{% endblock %}</title>
    <meta name="description" content="{% block description %}{% endblock %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="{% sass_src 'css/style.scss' %}" >
    <link rel="stylesheet" type="text/css" href="{% static 'css/star-rating-svg.css' %}">
    <link rel="icon" type="image/png" href="{% static 'img/favi.png' %}">
    <script src={% static 'js/jquery.min.js' %}></script>
    <script src="{% static 'js/jquery.star-rating-svg.js' %}"></script>
    {% block extra_head %}
    {% endblock %}
</head>
<body>
    {% if user.is_authenticated %}
        <div class="manager-button">
            <a href="{% url 'manager' %}"><img src="{% static 'img/boss.png' %}"></a>
        </div>
    {% endif %}
    <div class="nav-mobile" id="nav-mobile">
        <div class="nav-mobile-content">
            <span id="nav-close">&times;</span>
            <div class="nav-text">
                <a href="{% url 'home' %}">–†–µ–π—Ç–∏–Ω–≥</a>
                <a href="{% url 'news' %}">–ù–æ–≤–æ—Å—Ç–∏</a>
                <a href="{% url 'articles' %}">–°—Ç–∞—Ç—å–∏</a>
                <a href="{% url 'home' %}?h=–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ_–∫–∞—Ä—Ç—ã">–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã</a>
                <a href="{% url 'home' %}?h=–º—Ñ–æ">–û–Ω–ª–∞–π–Ω –ó–∞–π–º—ã</a>
            </div>
        </div>
    </div>
    <section class="header">
        <nav>
            <a href="{% url 'home' %}"><img src="{% static 'img/kreditobzor-logo.png' %}" alt="–ö—Ä–µ–¥–∏—Ç–û–±–∑–æ—Ä - –æ—Ç–∑—ã–≤—ã –æ –∑–∞–π–º–∞—Ö –Ω–∞ –∫–∞—Ä—Ç—É"></a>
            <a href="{% url 'home' %}"><p>–†–µ–π—Ç–∏–Ω–≥</p></a>
            <a href="{% url 'news' %}"><p>–ù–æ–≤–æ—Å—Ç–∏</p></a>
            <a href="{% url 'articles' %}"><p>–°—Ç–∞—Ç—å–∏</p></a>
            <a href="{% url 'home' %}?h=–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ_–∫–∞—Ä—Ç—ã"><p>–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã</p></a>
            <a href="{% url 'home' %}?h=–º—Ñ–æ"><p>–û–Ω–ª–∞–π–Ω –ó–∞–π–º—ã</p></a>
            <div class="nav-menu" id="nav-menu">
                <img src="{% static 'img/menubutton.png' %}">
            </div>
        </nav>
        <div class="header-text">
            <h1>–ù–∞—Ä–æ–¥–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –æ–Ω–ª–∞–π–Ω –∑–∞–π–º–æ–≤</h1>
            <h2>–û—Ç–∑—ã–≤—ã –æ–± –æ–Ω–ª–∞–π–Ω –∑–∞–π–º–∞—Ö, –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö</h2>
            <p>–ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–æ–±—Ä–∞—Ç—å –¥–ª—è —Å–µ–±—è –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ
                –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –æ—Ü–µ–Ω–∫–∞—Ö –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∞–π—Ç–∞</p>
        </div>
        {% block filters %}
            <div class="filters">
                <p>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</p>
                <div class="filters-list">
                    <select onChange="window.location.href=this.value">
                        <option value="" disabled selected>{{ app_name }}</option>
                        <option value="?h=–º—Ñ–æ">–ó–∞–π–º—ã</option>
                        <option value="?h=–∫—Ä–µ–¥–∏—Ç–Ω—ã–µ_–∫–∞—Ä—Ç—ã">–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã</option>
                    </select>
                    {% for key, value in filter_list.items %}
                    <a {% if filter == value %}class="active"{% endif %} href="/?s={{ key }}">
                        {{ value }}
                    </a>
                    {% endfor %}
                    <div class="mobile-filters">
                        <select onChange="window.location.href=this.value">
                            <option value="" disabled selected>{{ filter }}</option>
                            {% for key, value in filter_list.items %}
                                <option value="/?s={{ key }}">{{ value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        {% endblock %}
        <div class="girls">
            <img src="{% static 'img/kreditobzor-promo.jpg' %}" alt="–∑–∞–π–º –æ–Ω–ª–∞–π–Ω">
        </div>
    </section>
    <section class="content">
        {% block main %}
        {% endblock %}
            {% block sidebar %}
            <div class="sidebar">
            {% for sidebanner in sidebanners %}
                <div class="sidebanner">
                    <a href={% url 'ads:sidebanner_count' sidebanner.pk %}><img src="{{ sidebanner.image.url }}" alt="{{ sidebanner.title }}"></a>
                </div>
            {% endfor %}
            </div>
        {% endblock %}
    </section>
    <footer>
    {% block footer %}
    {% endblock %}
    <script>
        var navModal = document.getElementById("nav-mobile");
        var navBtn = document.getElementById("nav-menu");
        var navClose = document.getElementById("nav-close");

        navBtn.onclick = function() {
          navModal.style.display = "block";};

        navClose.onclick = function() {
          navModal.style.display = "none";};

        window.onclick = function(event) {
          if (event.target === navModal) {
            navModal.style.display = "none";
          }
        };

        const pushForm = document.getElementById('send-push__form');
        const errorMsg = document.querySelector('.error');

        pushForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const input = this[0];
            const textarea = this[1];
            const button = this[2];
            errorMsg.innerText = '';

            const head = input.value;
            const body = textarea.value;
            const meta = document.querySelector('meta[name="user_id"]');
            const id = meta ? meta.content : null;

            if (head && body && id) {
                button.innerText = 'Sending...';
                button.disabled = true;

                const res = await fetch('send_push', {
                    method: 'POST',
                    body: JSON.stringify({head, body, id}),
                    headers: {
                        'content-type': 'application/json'
                    }
                });
                if (res.status === 200) {
                    button.innerText = 'Send another üòÉ!';
                    button.disabled = false;
                    input.value = '';
                    textarea.value = '';
                } else {
                    errorMsg.innerText = res.message;
                    button.innerText = 'Something broke üò¢..  Try again?';
                    button.disabled = false;
                }
            }
            else {
                let error;
                if (!head || !body){
                    error = 'Please ensure you complete the form üôèüèæ'
                }
                else if (!id){
                    error = "Are you sure you're logged in? ü§î. Make sure! üëçüèº"
                }
                errorMsg.innerText = error;
            }
        });
    </script>
    </footer>
{% block extra_js %}
{% endblock %}
</body>
</html>